{
  "name": "Telegram Voice Assistant (공유용)",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Listen for incoming events').first().json.message.from.id }}"
      },
      "id": "cf1f4660-29a3-4ceb-b79f-41295cedcba5",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        2304,
        480
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "operation": "getAll",
        "filters": {
          "labelIds": [
            "INBOX",
            "UNREAD"
          ],
          "readStatus": "unread",
          "receivedAfter": "={{$fromAI(\"date\",\"the date after which to fetch the messages in format YYYY-MM-DDTHH:MM:SS\")}}"
        }
      },
      "id": "1903ba31-ae49-4b84-a0cf-2b1f20189382",
      "name": "Get Email",
      "type": "n8n-nodes-base.gmailTool",
      "position": [
        2448,
        480
      ],
      "typeVersion": 2.1,
      "webhookId": "38f53ad0-699d-414c-a6d3-69a9aa502fd9",
      "credentials": {
        "gmailOAuth2": {
          "id": "FESGt8Wy0t1sRoJv",
          "name": "(DP) Gmail account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "30820273-cde9-4c19-9e62-1f2643fc15c0",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        2144,
        480
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "Iy8nJTvO4bCB8mYA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {}
      },
      "id": "8eb9b547-3246-4791-915d-67618a766c1d",
      "name": "Listen for incoming events",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [
        848,
        240
      ],
      "webhookId": "3e740939-1d98-4a54-b317-482fd155eab1",
      "typeVersion": 1,
      "credentials": {
        "telegramApi": {
          "id": "9auPNi1bb9FBoAuM",
          "name": "(DP)Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Listen for incoming events').first().json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "5f82c652-aff5-41f9-aca2-e179fd1a3982",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        2768,
        224
      ],
      "typeVersion": 1.1,
      "webhookId": "b953ffbb-b1c9-4a1f-abea-f58c63e0c4ba",
      "credentials": {
        "telegramApi": {
          "id": "9auPNi1bb9FBoAuM",
          "name": "(DP)Telegram account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "a8214e7c-6093-4ce5-bea6-0a3312599ccb",
      "name": "Speech to Text",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        1760,
        64
      ],
      "typeVersion": 1.3,
      "credentials": {
        "openAiApi": {
          "id": "Iy8nJTvO4bCB8mYA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "text",
              "stringValue": "={{ $json?.message?.text || \"\" }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b9a8ed30-ba54-479b-bc41-b72522f7c2ab",
      "name": "Voice or Text",
      "type": "n8n-nodes-base.set",
      "position": [
        1072,
        240
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Listen for incoming events').item.json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "id": "c0f9a94c-8697-4dcf-88f8-fa90d20b3290",
      "name": "Get Voice File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        1552,
        64
      ],
      "typeVersion": 1.1,
      "webhookId": "0b92ad37-ebac-408d-922c-231f9e88c147",
      "credentials": {
        "telegramApi": {
          "id": "9auPNi1bb9FBoAuM",
          "name": "(DP)Telegram account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Process Telegram Request\n",
        "height": 247,
        "width": 496,
        "color": 5
      },
      "id": "fc1519c8-8880-40e9-b9c9-2a707252ed70",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        992,
        160
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=오늘 날짜는 {{ $now }}입니다.\n\n지침:\n\t•\t이메일을 가져올 때, 홍보성 이메일은 필터링하세요.\n\t•\t이메일을 요약할 때는 발신자(Sender), 발송일(Message date), 제목(subject), 이메일의 간단한 요약을 포함하세요.\n\t•\t사용자가 날짜를 명시하지 않은 경우, 기본적으로 “오늘”을 요청한 것으로 간주하세요.\n\t•\t캘린더 일정에 대한 질문에 답할 때는, 질문과 관련 없는 일정은 제외하세요. 예를 들어, 질문이 오늘 일정에 관한 것이라면, 오늘 일정만 답변하고 1주일 이상 남은 미래 일정은 언급하지 마세요.\n\n\n만약, 사용자가 하나 이상의 파일을 업로드한 경우, 각 파일의 이름이나 내용을 기반으로 파일의 유형을 식별하세요 (예: `.csv`, `.pdf`, `.json`, `.md`, `.xlsx`, `.docx`, `.txt`, `.zip`, `.png`, `.mp4` 등).\n\n각 파일에 대해 다음 정보를 출력하세요:\n- **파일명**: 파일의 실제 이름\n- **파일 유형**: 확장자 또는 내용 기반으로 판단한 파일 형식\n- **설명**: 이 파일 유형이 일반적으로 어떤 목적으로 사용되는지 간단히 설명\n- **처리 방법**: 이 파일을 어떻게 분석하거나 활용할 수 있는지 구체적으로 설명\n\n파일이 첨부된 경우에만 이 설명을 출력하며, 첨부된 파일이 없을 경우 이 섹션은 생략합니다.\n\n⸻\n\n📚 파일 유형별 처리 규칙 예시\n\n파일 확장자\t설명\t처리 방법\n.csv\t쉼표로 구분된 표 형식 데이터 파일입니다.\t행(row)과 열(column)을 기준으로 테이블 데이터를 분석할 수 있습니다.\n.json\t계층적 구조의 키-값 쌍으로 구성된 데이터 파일입니다.\t구조화된 데이터를 파싱하여 필요한 정보를 추출하거나 재구성할 수 있습니다.\n.pdf\t텍스트와 이미지가 고정된 형식으로 포함된 문서입니다.\tPDF 파서를 통해 본문을 추출하거나 OCR을 이용해 텍스트화할 수 있습니다.\n.xlsx\tExcel 워크북 형식의 파일로, 다중 시트를 포함할 수 있습니다.\t셀 데이터를 읽고 계산하거나 시트별로 정리된 데이터를 분석할 수 있습니다.\n.txt\t서식 없는 일반 텍스트 파일입니다.\t줄 단위로 내용을 분석하거나, 키워드 추출 및 요약이 가능합니다.\n.md\t마크다운 형식으로 구조화된 텍스트 문서입니다.\t제목, 리스트, 코드 블록 등을 구분하여 구조화된 정보를 파악할 수 있습니다.\n.docx\tMicrosoft Word 문서입니다.\t본문 내용을 텍스트로 추출하여 요약하거나 키워드 중심 분석이 가능합니다.\n.zip\t하나 이상의 파일이 포함된 압축 형식의 파일입니다.\t압축을 해제하여 개별 파일을 식별 및 분석해야 합니다.\n.png, .jpg\t이미지 파일입니다.\tOCR을 통해 텍스트를 추출하거나 이미지 인식을 통해 주요 특징을 파악할 수 있습니다.\n.mp4\t영상 파일입니다.\t오디오에서 텍스트를 추출(STT)하고 요약 또는 분석할 수 있습니다.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        2272,
        224
      ],
      "id": "c46ff278-d0be-4721-bae8-2e6a08b3bc0a",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "content": "## Q. 00님이 보낸 최근 7일간 메일들 리스트업 해줘",
        "height": 80,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2080,
        640
      ],
      "id": "5a95b99b-c238-4d38-bc2d-1f76d741e068",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Q. 이번주말/다음주에 중요 일정 요약해줘",
        "height": 80,
        "width": 368
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2416,
        640
      ],
      "id": "9bfeb713-97c5-4b39-9dc6-7088e8b71a7c",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "datapopcorn@gmail.com",
          "mode": "list",
          "cachedResultName": "datapopcorn@gmail.com"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "options": {
          "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', `the date after which to fetch the messages in format YYYY-MM-DDTHH:MM:SS`, 'string') }}"
        }
      },
      "id": "c72c0a58-1eb3-4d0b-aef4-a7b57a08604e",
      "name": "Get many events in Google Calendar",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        2592,
        480
      ],
      "typeVersion": 1.1,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "PIzJ5EWqdB2CdQX7",
          "name": "(DP) Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Listen for incoming events').item.json.message.voice.file_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "a3d07c4a-9832-4cf0-8c72-81abc7b21554"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7440eb8d-84b9-4959-aefc-9ca0790263e0",
                    "leftValue": "={{ $('Listen for incoming events').item.json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7c88d5de-d191-43b0-9340-1e4ea1cb0403",
                    "leftValue": "={{ $('Listen for incoming events').item.json.message.document.mime_type }}",
                    "rightValue": "text/csv",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text/csv"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9ec6e055-c04b-4f37-ab9b-89c124b64473",
                    "leftValue": "={{ $('Listen for incoming events').item.json.message.document.mime_type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "application/pdf"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1312,
        208
      ],
      "id": "816f53ae-224b-45dc-8805-1295a99b7534",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Listen for incoming events').item.json.message.document.file_id }}",
        "additionalFields": {}
      },
      "id": "a5d3f811-71e5-417e-957b-82a882ed8a2d",
      "name": "Get CSV File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        1552,
        304
      ],
      "typeVersion": 1.1,
      "webhookId": "eb275642-406b-407f-bfd3-95d626b4e0f3",
      "credentials": {
        "telegramApi": {
          "id": "9auPNi1bb9FBoAuM",
          "name": "(DP)Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Listen for incoming events').item.json.message.document.file_id }}",
        "additionalFields": {}
      },
      "id": "e3e669ed-6955-424b-ab58-889823627be7",
      "name": "Get PDF File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        1552,
        512
      ],
      "typeVersion": 1.1,
      "webhookId": "9495704b-add9-40a8-838c-48df2787bbb3",
      "credentials": {
        "telegramApi": {
          "id": "9auPNi1bb9FBoAuM",
          "name": "(DP)Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1744,
        512
      ],
      "id": "520a05fc-d74e-4760-a98e-8493be5a05fb",
      "name": "Extract from File (PDF)"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1760,
        304
      ],
      "id": "df586822-a042-486f-b91f-a24d1916dec5",
      "name": "Extract from File (CSV)"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "text",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1968,
        304
      ],
      "id": "2981b18b-5336-410e-aaa7-44ad6c8a0238",
      "name": "Aggregate"
    }
  ],
  "pinData": {
    "Listen for incoming events": [
      {
        "json": {
          "update_id": 310539715,
          "message": {
            "message_id": 95,
            "from": {
              "id": 7280645492,
              "is_bot": false,
              "first_name": "인영",
              "language_code": "ko"
            },
            "chat": {
              "id": 7280645492,
              "first_name": "인영",
              "type": "private"
            },
            "date": 1754287742,
            "document": {
              "file_name": "Group.png",
              "mime_type": "image/png",
              "thumbnail": {
                "file_id": "AAMCBQADGQEAA19okE5-5vwYm3XgbcyJ6Dege-zUoAAC1x0AAuNXgFTN51OlSyHR6AEAB20AAzYE",
                "file_unique_id": "AQAD1x0AAuNXgFRy",
                "file_size": 35613,
                "width": 320,
                "height": 320
              },
              "thumb": {
                "file_id": "AAMCBQADGQEAA19okE5-5vwYm3XgbcyJ6Dege-zUoAAC1x0AAuNXgFTN51OlSyHR6AEAB20AAzYE",
                "file_unique_id": "AQAD1x0AAuNXgFRy",
                "file_size": 35613,
                "width": 320,
                "height": 320
              },
              "file_id": "BQACAgUAAxkBAANfaJBOfub8GJt14G3Mieg3oHvs1KAAAtcdAALjV4BUzedTpUsh0eg2BA",
              "file_unique_id": "AgAD1x0AAuNXgFQ",
              "file_size": 81891
            }
          }
        }
      }
    ]
  },
  "connections": {
    "Get Email": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Voice or Text": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Voice File": {
      "main": [
        [
          {
            "node": "Speech to Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Speech to Text": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Listen for incoming events": {
      "main": [
        [
          {
            "node": "Voice or Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many events in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get Voice File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get CSV File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get PDF File",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get CSV File": {
      "main": [
        [
          {
            "node": "Extract from File (CSV)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get PDF File": {
      "main": [
        [
          {
            "node": "Extract from File (PDF)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File (CSV)": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File (PDF)": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "bd0f135a-66b7-40ff-b64a-8314ab22285e",
  "meta": {
    "templateId": "2462",
    "templateCredsSetupCompleted": true,
    "instanceId": "b5ece4a7f1d316800b5067c86423ddc5cb2f9cd86ec345924a6f385dc750a41b"
  },
  "id": "VZjpYYzuvyxNQL5s",
  "tags": [
    {
      "createdAt": "2025-06-25T04:00:38.130Z",
      "updatedAt": "2025-06-25T04:00:38.130Z",
      "id": "EyGUZypc5DKHVUyY",
      "name": "패스트캠퍼스"
    }
  ]
}